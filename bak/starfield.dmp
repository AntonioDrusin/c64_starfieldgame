00001  0000             ; 10 SYS (2096)
00002  0001             
00003  0001             GENERATETO STARFIELD.PRG
00004  0001             DEBUGSTARTADDRESS START
00005  0001             
00006  0001             VIC_COLOR  = $D800
00007  0001             
00008  0001             ; COLORS
00009  0001             VIC_BLACK  = $00
00010  0001             VIC_WHITE  = $01
00011  0001             VIC_RED    = $02
00012  0001             VIC_CYAN   = $03
00013  0001             VIC_VIOLET = $04
00014  0001             VIC_GREEN  = $05
00015  0001             VIC_BLUE   = $06
00016  0001             VIC_YELLOW = $07
00017  0001             VIC_ORANGE = $08
00018  0001             VIC_BROWN  = $09
00019  0001             VIC_LIGHTRED = $0A
00020  0001             VIC_DARKGREY = $0B
00021  0001             VIC_GREY   = $0C
00022  0001             VIC_LIGHTGREEN = $0D
00023  0001             VIC_LIGHTBLUE = $0E
00024  0001             VIC_LIGHTGRAY = $0F
00025  0001             
00026  0001             ; REGISTERS
00027  0001             
00028  0001             ; SPRITES
00029  0001             VIC_SP0_X  = $D000
00030  0001             VIC_SP0_Y  = $D001
00031  0001             VIC_SP1_X  = $D002
00032  0001             VIC_SP1_Y  = $D003
00033  0001             VIC_SP2_X  = $D004
00034  0001             VIC_SP2_Y  = $D005
00035  0001             VIC_SP3_X  = $D006
00036  0001             VIC_SP3_Y  = $D007
00037  0001             VIC_SP4_X  = $D008
00038  0001             VIC_SP4_Y  = $D009
00039  0001             VIC_SP5_X  = $D00A
00040  0001             VIC_SP5_Y  = $D00B
00041  0001             VIC_SP6_X  = $D00C
00042  0001             VIC_SP6_Y  = $D00D
00043  0001             VIC_SP7_X  = $D00E
00044  0001             VIC_SP7_Y  = $D00F
00045  0001             VIC_SPX    = $D010
00046  0001             
00047  0001             ; COLORS
00048  0001             VIC_BORDERC = $D020
00049  0001             VIC_BG0C   = $D021
00050  0001             VIC_BG1C   = $D022
00051  0001             VIC_BG2C   = $D023
00052  0001             VIC_BG3C   = $D024
00053  0001             VIC_SP0MC  = $D025
00054  0001             VIC_SP1MC  = $D026
00055  0001             VIC_SP0C   = $D027
00056  0001             VIC_SP1C   = $D028
00057  0001             VIC_SP2C   = $D029
00058  0001             VIC_SP3C   = $D02A
00059  0001             VIC_SP4C   = $D02B
00060  0001             VIC_SP5C   = $D02C
00061  0001             VIC_SP6C   = $D02D
00062  0001             VIC_SP7C   = $D02E
00063  0001             
00064  0001             
00065  0001             ; CONTROL
00066  0001             VIC_MEM    = $D018
00067  0001             VIC_RASTER = $D012
00068  0001             
00069  0001             ; CIAB
00070  0001             CIAB_PRA   = $DD00
00071  0001             
00072  0001             
00073  0001             DEFM       ADDAW
00074  0001                        CLC
00075  0001                        LDA /2
00076  0001                        ADC #</1
00077  0001                        STA /2
00078  0001                        LDA /2+1
00079  0001                        ADC #>/1
00080  0001                        STA /2+1
00081  0001                        
00082  0001                        ENDM
00083  0001             
00084  0001             
00085  0001             DEFM       MOVEW
00086  0001                        LDA #</1
00087  0001                        STA /2
00088  0001                        LDA #>/1
00089  0001                        STA /2+1
00090  0001                        ENDM
00091  0001             
00092  0001                        
00093  0001             
00094  0001             *=$0801
00095  0801             
00096  0801  0E 08 0A              BYTE    $0E, $08, $0A, $00, $9E, $20, $28,  $32, $30, $39, $36, $29, $00, $00, $00
00097  0810             
00098  0810             *=$830
00099  0830             
00100  0830             SCREEN     = $8400
00101  0830             CHARS      = $B000
00102  0830             CHARSETEND = $BFFF
00103  0830             
00104  0830             ; STARSCROLLER
00105  0830             STARCHAR   = 36
00106  0830             STAR_CHARS0 = CHARS+288
00107  0830             STAR_CHARS1 = CHARS+296
00108  0830             
00109  0830             ; *********************
00110  0830             ; ZERO PAGE VARIABLES
00111  0830             ; *********************
00112  0830             
00113  0830             ; VARIABLES
00114  0830             SCRPTR     = $10    ; FOR CHARACTER FILLING
00115  0830             ATEMP      = $12    ; STORE A SOMETIMES
00116  0830             FRAMECT    = $13
00117  0830             CURCOLOR   = $14   ; WORD
00118  0830             CURPTR     = $16   ; GENERIC POINTER
00119  0830             CURSCRNPTR = $18   ; GENERIC SCREEN POINTER
00120  0830             DELAY      = $20
00121  0830             DELTA      = $21   ; DELTA CHARACTERS FOR SCREEN SCROLL
00122  0830             
00123  0830             ; TEMP VARIABLES FOR PROGRAMS:
00124  0830             ; $FF DESCENDING
00125  0830             
00126  0830             
00127  0830             
00128  0830             OB_TYPE    = 0
00129  0830             OB_H       = 1
00130  0830             OB_L       = 2
00131  0830             OB_Y       = 3
00132  0830             OB_X1      = 4
00133  0830                        
00134  0830             START
00135  0830  20 5C 0A              JSR     INITLEVEL
00136  0833             
00137  0833                        ; DISABLE CIA INTERRUPT (IS THIS ON BY DEFAULT FOR BASIC?)
00138  0833                        ; THIS IS IMPORTANT OR THE COPY CHAR ROUTINE WILL CRASH FOR SOME REASON
00139  0833  AD 0E DC              LDA $DC0E
00140  0836  29 FE                 AND #$FE
00141  0838  8D 0E DC              STA $DC0E
00142  083B                        ; DISABLE ALL CPU INTERRUPT
00143  083B  78                    SEI
00144  083C                        
00145  083C  20 30 0A              JSR INITMULTABLE
00146  083F             
00147  083F                        ; DEBUG HERE
00148  083F                        ; END DEBUG
00149  083F             
00150  083F  A5 01                 LDA $1
00151  0841  29 FB                 AND #$FB
00152  0843  85 01                 STA $1   ; CHAR ROM VISIBLE AT $D000
00153  0845             
00154  0845             
00155  0845                        ; **********
00156  0845                        ; COPY CHARS
00157  0845                        ; **********
00158  0845             
00159  0845                        ; HTTPS://WWW.PAGETABLE.COM/C64REF/C64DISASM/
00160  0845  A9 00                 LDA #$0
00161  0847  A0 D0                 LDY #$D0
00162  0849  85 5F                 STA 95
00163  084B  84 60                 STY 96
00164  084D  A9 FF                 LDA #$FF
00165  084F  A0 DF                 LDY #$DF
00166  0851  85 5A                 STA 90
00167  0853  84 5B                 STY 91
00168  0855  A9 FF                 LDA #<CHARSETEND         ; MUST KEEP THESE VALUES IN A AND Y
00169  0857  A0 BF                 LDY #>CHARSETEND
00170  0859  85 58                 STA 88
00171  085B  84 59                 STY 89
00172  085D  20 BF A3              JSR $A3BF       ; BLOCK COPY
00173  0860             
00174  0860  A5 01                 LDA $1
00175  0862  29 F8                 AND #$F8
00176  0864  09 05                 ORA #$05        ; ALL RAM, EXCEPT FOR I/O
00177  0866  85 01                 STA $1
00178  0868             
00179  0868             
00180  0868                        
00181  0868                        ; VIC II ON BANK 2 ($8000-$BFFF)
00182  0868  AD 00 DD              LDA CIAB_PRA
00183  086B  29 FC                 AND #$FC
00184  086D  09 01                 ORA #$1
00185  086F  8D 00 DD              STA CIAB_PRA
00186  0872                        
00187  0872             
00188  0872                        ; SELECT VIC CHARACTER BANK TO $3000
00189  0872  AD 18 D0              LDA VIC_MEM     ; DEFAULT $15
00190  0875  29 F0                 AND #$F0
00191  0877  09 0C                 ORA #$0C
00192  0879  8D 18 D0              STA VIC_MEM       ; $1C
00193  087C             
00194  087C             
00195  087C                        ; ******************************************
00196  087C                        ; FILL SCREEN WITH ALTERNATING BC CHARACTERS
00197  087C                        ; ******************************************
00198  087C             
00199  087C             
00200  087C             
00201  087C  A9 00                 LDA #<SCREEN
00202  087E  85 10                 STA SCRPTR
00203  0880  A9 84                 LDA #>SCREEN
00204  0882  85 11                 STA SCRPTR+1
00205  0884  A2 19                 LDX #25                ; 25 LINES
00206  0886  A9 24                 LDA #STARCHAR          ; FIRST OF TWO ALTERNATING CHARS
00207  0888             @ROWLOOP
00208  0888  A0 27                 LDY #39
00209  088A             @LOOP      
00210  088A  91 10                 STA (SCRPTR),Y
00211  088C  49 01                 EOR #$1                 ; OTHER CHARACTER
00212  088E  88                    DEY
00213  088F  10 F9                 BPL @LOOP
00214  0891                        
00215  0891  49 01                 EOR #$1
00216  0893                        
00217  0893  85 12                 STA ATEMP
00218  0895             
00219  0895             
00220  0895  18                    CLC
00221  0896  A5 10                 LDA SCRPTR
00222  0898  69 28                 ADC #<40
00223  089A  85 10                 STA SCRPTR
00224  089C  A5 11                 LDA SCRPTR+1
00225  089E  69 00                 ADC #>40
00226  08A0  85 11                 STA SCRPTR+1
00227  08A2                        
00228  08A2  A5 12                 LDA ATEMP
00229  08A4                        
00230  08A4  CA                    DEX
00231  08A5  D0 E1                 BNE @ROWLOOP
00232  08A7             
00233  08A7                        ; ************
00234  08A7                        ; SETUP COLORS
00235  08A7                        ; ************
00236  08A7  A9 00                 LDA     #$0
00237  08A9  8D 20 D0              STA     $D020   ; BORDER
00238  08AC  8D 21 D0              STA     $D021   ; BACKGROUND
00239  08AF             
00240  08AF             
00241  08AF  A9 00                 LDA     #<VIC_COLOR
00242  08B1  85 14                 STA     CURCOLOR
00243  08B3  A9 D8                 LDA     #>VIC_COLOR
00244  08B5  85 15                 STA     CURCOLOR+1
00245  08B7             
00246  08B7  A9 06                 LDA     #VIC_BLUE
00247  08B9  20 19 0A              JSR     TRIBAND
00248  08BC  A9 0E                 LDA     #VIC_LIGHTBLUE
00249  08BE  20 19 0A              JSR     TRIBAND
00250  08C1  A9 07                 LDA     #VIC_YELLOW
00251  08C3  20 19 0A              JSR     TRIBAND
00252  08C6  A9 01                 LDA     #VIC_WHITE
00253  08C8  20 19 0A              JSR     TRIBAND
00254  08CB  A9 01                 LDA     #VIC_WHITE
00255  08CD  20 19 0A              JSR     TRIBAND
00256  08D0  A9 07                 LDA     #VIC_YELLOW
00257  08D2  20 19 0A              JSR     TRIBAND
00258  08D5  A9 0A                 LDA     #VIC_LIGHTRED
00259  08D7  20 19 0A              JSR     TRIBAND
00260  08DA  A9 02                 LDA     #VIC_RED
00261  08DC  20 19 0A              JSR     TRIBAND
00262  08DF             
00263  08DF             
00264  08DF                        ; ********************
00265  08DF                        ; PREP STAR CHARACTERS
00266  08DF                        ; ********************
00267  08DF             
00268  08DF                        ; STARS ARE ON LINE 3
00269  08DF                        ; AND ON LINE 7
00270  08DF  A9 00                 LDA #$0
00271  08E1  A2 0F                 LDX #15
00272  08E3             @NULCHAR
00273  08E3  9D 20 B1              STA STAR_CHARS0,X
00274  08E6  CA                    DEX
00275  08E7  10 FA                 BPL @NULCHAR
00276  08E9             
00277  08E9  A9 10                 LDA #$10
00278  08EB  8D 23 B1              STA STAR_CHARS0+3
00279  08EE  A9 02                 LDA #$02
00280  08F0  8D 2F B1              STA STAR_CHARS1+7
00281  08F3             
00282  08F3             
00283  08F3             
00284  08F3                        ; *********
00285  08F3                        ; MAIN LOOP
00286  08F3                        ; *********
00287  08F3             
00288  08F3  A9 00                 LDA     #$00
00289  08F5  85 13                 STA     FRAMECT
00290  08F7             FOREVER
00291  08F7             
00292  08F7  A9 FF                 LDA     #$FF
00293  08F9             WAIT
00294  08F9  CD 12 D0              CMP     VIC_RASTER
00295  08FC  D0 FB                 BNE     WAIT
00296  08FE             
00297  08FE  A9 02                 LDA     #VIC_RED
00298  0900  8D 20 D0              STA     VIC_BORDERC
00299  0903             
00300  0903             ;**********************
00301  0903             ; BACKGROUND SCROLLING
00302  0903             ;**********************
00303  0903             
00304  0903                        ; SCROLL FAST STAR
00305  0903  18                    CLC
00306  0904  AD 2B B1              LDA     STAR_CHARS1+3
00307  0907  2A                    ROL
00308  0908  8D 2B B1              STA     STAR_CHARS1+3
00309  090B  AD 23 B1              LDA     STAR_CHARS0+3
00310  090E  2A                    ROL
00311  090F  8D 23 B1              STA     STAR_CHARS0+3
00312  0912  90 08                 BCC     @NOL
00313  0914  AD 2B B1              LDA     STAR_CHARS1+3
00314  0917  09 01                 ORA     #$01
00315  0919  8D 2B B1              STA     STAR_CHARS1+3
00316  091C             @NOL       
00317  091C             
00318  091C                        ; CHECK IF SCROLL SLOW STAR
00319  091C  A6 13                 LDX     FRAMECT
00320  091E  E8                    INX
00321  091F  86 13                 STX     FRAMECT
00322  0921  8A                    TXA
00323  0922  29 01                 AND     #$01
00324  0924  D0 19                 BNE     @NOS
00325  0926             
00326  0926                        ; SCROLL LOW STAR
00327  0926  18                    CLC
00328  0927  AD 2F B1              LDA     STAR_CHARS1+7
00329  092A  2A                    ROL
00330  092B  8D 2F B1              STA     STAR_CHARS1+7
00331  092E  AD 27 B1              LDA     STAR_CHARS0+7
00332  0931  2A                    ROL
00333  0932  8D 27 B1              STA     STAR_CHARS0+7
00334  0935  90 08                 BCC     @NOR
00335  0937  AD 2F B1              LDA     STAR_CHARS1+7
00336  093A  09 01                 ORA     #$01
00337  093C  8D 2F B1              STA     STAR_CHARS1+7
00338  093F             @NOR
00339  093F                        
00340  093F                        
00341  093F             @NOS
00342  093F             
00343  093F             
00344  093F             ; 1 SCROLL SCREEN 1 CHAR AT A TIME
00345  093F             ; 2 RESTORE BACKGROUND
00346  093F             ; CREATE LINES BY "LEVEL DESIGN"
00347  093F             ; ADD SPRITE   -> FUN
00348  093F             ; SCROLL SCREEN AT FINE RESOLUTION
00349  093F             ; FIX BACKGROUND AT FINE RESOLUTION
00350  093F             
00351  093F                        
00352  093F             ; ******************
00353  093F             ; SCROLL FRONT
00354  093F             ; ******************
00355  093F                        
00356  093F                        ; FOR EACH OBJECTS
00357  093F             
00358  093F                        ; IF X1 IS NEGATIVE, SKIP THIS.
00359  093F                        ; AT X1-DELTA
00360  093F                        ; DRAW FRONT
00361  093F                        ; IF DELTA >1
00362  093F                        ; FOR EACH REMAINING DELTA, DRAW MIDDLE
00363  093F             
00364  093F                        ; SUBTRACT DELTA FROM L
00365  093F                        ; SUBTRACT DELTA FROM X1
00366  093F             
00367  093F                        ; IF L <=0
00368  093F                        ; DRAW END AT L+39
00369  093F                        ; IF L+39 <0 , RESET OBJECT
00370  093F                        ; DRAW BACKGROUNDS FOR EACH DELTA
00371  093F             
00372  093F                        ; DONE
00373  093F             O0_FU=85
00374  093F             O0_FM=66
00375  093F             O0_FB=74
00376  093F             O0_MU=67
00377  093F             O0_MM=102
00378  093F             O0_MB=67
00379  093F             O0_BU=73
00380  093F             O0_BM=72
00381  093F             O0_BB=75
00382  093F             
00383  093F             
00384  093F                        ; (WE MAY NOT NEED X2)
00385  093F             OBJECTGEN
00386  093F             
00387  093F             ; VARIABLES
00388  093F             @CUROBJ    = $FF   ; CURRENT OBJECT OFFSET, BYTE
00389  093F             @VH        = $FE   ; JUST A VARIABLE
00390  093F             @UNUSED    = $FD   ;
00391  093F             @HFLAG     = $FC   ; PAINT HEAD ?
00392  093F             @VHX       = $FB   ; CURRENT OBJECT X (WHERE HEAD IS)
00393  093F             @HFOLLOWLEN = $FA   ; HOW LONG THE TRAIL AFTER PAINTING THE HEAD
00394  093F             @HFSKIPLEN = $F9   ; HOW MANY CHARS TO SKIP BEFORE PAINTING THE HEAD TRAIL
00395  093F             
00396  093F  A9 06                 LDA     #VIC_BLUE
00397  0941  8D 20 D0              STA     VIC_BORDERC
00398  0944             
00399  0944             
00400  0944  A9 02                 LDA     #2              ; SCROLL 0-4
00401  0946  85 21                 STA     DELTA           ; JUST FIXED SCROLLING BY 2
00402  0948             
00403  0948                        ; OBJECT PTR
00404  0948  A2 00                 LDX     #0
00405  094A  86 FF                 STX     @CUROBJ
00406  094C             
00407  094C             
00408  094C  BD D7 0A              LDA     OB_TYPE+OBJTABLE,X      ; TEST IF OBJECT IS LIVE
00409  094F  D0 03                 BNE     @DOTHISOBJECT
00410  0951  4C 0F 0A              JMP     @ENDOBJ
00411  0954             
00412  0954             @DOTHISOBJECT 
00413  0954             
00414  0954                        ; ******
00415  0954                        ; MOVE OBJECT LEFT
00416  0954                        ; ******
00417  0954  BD D9 0A              LDA     OB_L+OBJTABLE,X
00418  0957  38                    SEC
00419  0958  E5 21                 SBC     DELTA
00420  095A  9D D9 0A              STA     OB_L+OBJTABLE,X
00421  095D             
00422  095D  BD DB 0A              LDA     OB_X1+OBJTABLE,X
00423  0960  38                    SEC
00424  0961  E5 21                 SBC     DELTA
00425  0963  9D DB 0A              STA     OB_X1+OBJTABLE,X
00426  0966  85 FB                 STA     @VHX
00427  0968             
00428  0968                        ; AVOID PAINTING IF X1 IS >39
00429  0968  C9 28                 CMP     #40
00430  096A  30 03                 BMI     @VISIBLE
00431  096C  4C 0F 0A              JMP     @ENDOBJ
00432  096F             
00433  096F             ; *** OLD STYLE
00434  096F             
00435  096F             @VISIBLE
00436  096F  A0 00                 LDY     #0
00437  0971  A5 FB                 LDA     @VHX                    ; X1 IS HEAD OF OBJECT
00438  0973  30 02                 BMI     @NOHEAD                 ; IF X1 IS NEGATIVE, NO NEED TO PAINT HEAD
00439  0975  A0 FF                 LDY     #$FF
00440  0977             @NOHEAD
00441  0977  84 FC                 STY     @HFLAG
00442  0979             
00443  0979  A5 21                 LDA     DELTA
00444  097B  85 FA                 STA     @HFOLLOWLEN
00445  097D  38                    SEC
00446  097E  A9 27                 LDA     #39
00447  0980  E5 FB                 SBC     @VHX
00448  0982  C5 21                 CMP     DELTA
00449  0984  10 02                 BPL     @FULLHFOLLOW
00450  0986  85 FA                 STA     @HFOLLOWLEN     ; THIS IS HOW LONG IS THE HEAD TRAIL TO PAINT.
00451  0988             @FULLHFOLLOW 
00452  0988             
00453  0988             
00454  0988                        ; CALCULATE HOW MUCH HEAD TRAIL TO SKIP (IN CASE THE TRAIL IS TOO MUCH ON THE LEFT)
00455  0988  38                    SEC
00456  0989  A9 FF                 LDA     #-1
00457  098B  E5 FB                 SBC     @VHX
00458  098D  10 02                 BPL     @HFSKIP
00459  098F  A9 00                 LDA     #0
00460  0991             @HFSKIP
00461  0991  85 F9                 STA     @HFSKIPLEN
00462  0993                        
00463  0993                        
00464  0993                        ; HOW MANY CHARACTER TO _ACTUALLY_ PAINT FOR THE HEAD FOLLOW LENGTH
00465  0993  38                    SEC
00466  0994  A5 FA                 LDA     @HFOLLOWLEN
00467  0996  E5 F9                 SBC     @HFSKIPLEN
00468  0998  85 FA                 STA     @HFOLLOWLEN
00469  099A             
00470  099A             
00471  099A             ; *** NEW STYLE
00472  099A             
00473  099A                        
00474  099A             
00475  099A                        ; ***********
00476  099A                        ; PAINT HEAD
00477  099A                        ; ***********
00478  099A             
00479  099A  BD D8 0A              LDA     OB_H+OBJTABLE,X
00480  099D  85 FE                 STA     @VH
00481  099F             
00482  099F  BD DA 0A              LDA     OB_Y+OBJTABLE,X         ; CURSCRNPTR = *(MULTABLE+O.Y*2)
00483  09A2  0A                    ASL
00484  09A3  AA                    TAX                             ; X = O.Y*2
00485  09A4  BD A5 0A              LDA     MULTABLE,X
00486  09A7  85 18                 STA     CURSCRNPTR
00487  09A9  BD A6 0A              LDA     MULTABLE+1,X
00488  09AC  85 19                 STA     CURSCRNPTR+1
00489  09AE             
00490  09AE                        ; REQUIREMENT: A IS NON ZERO HERE (LAST STA IS HIGH OF SCREEN PTR, WHICH IS $8000+)
00491  09AE             
00492  09AE                        ; TOP ROW
00493  09AE  24 FC                 BIT     @HFLAG
00494  09B0  F0 06                 BEQ     @NOTOPHEAD
00495  09B2                        ; SET SCREEN CHARACTER
00496  09B2  A4 FB                 LDY     @VHX                    ; X = O.X1
00497  09B4  A9 55                 LDA     #O0_FU                  ; *CURSCRNPTR+X
00498  09B6  91 18                 STA     (CURSCRNPTR),Y
00499  09B8             
00500  09B8             @NOTOPHEAD 
00501  09B8  A6 FA                 LDX     @HFOLLOWLEN
00502  09BA                        ; TOP ROW FOLLOW
00503  09BA             @TOPFOLLOW 
00504  09BA  CA                    DEX
00505  09BB  30 08                 BMI     @NOTOPFOLLOW
00506  09BD  C8                    INY
00507  09BE  A9 43                 LDA     #O0_MU
00508  09C0  91 18                 STA     (CURSCRNPTR),Y
00509  09C2  4C BA 09              JMP     @TOPFOLLOW
00510  09C5             @NOTOPFOLLOW 
00511  09C5                        
00512  09C5  A4 FE                 LDY     @VH
00513  09C7  88                    DEY
00514  09C8  F0 AD                 BEQ     @NOHEAD
00515  09CA             
00516  09CA             @MOREMIDDLE 
00517  09CA                        ; NEXT ROW
00518  09CA  18                    CLC                             ; 2
00519  09CB  A5 18                 LDA     CURSCRNPTR              ; 3 CURSCRNPTR += 40
00520  09CD  69 28                 ADC     #40                     ; 2
00521  09CF  85 18                 STA     CURSCRNPTR              ; 3
00522  09D1  A5 19                 LDA     CURSCRNPTR+1            ; 3
00523  09D3  69 00                 ADC     #0                      ; 2
00524  09D5  85 19                 STA     CURSCRNPTR+1            ; 3
00525  09D7                        
00526  09D7                        ; CHECK IF WE NEED TO PAINT THE MIDDLE
00527  09D7  88                    DEY
00528  09D8  84 FE                 STY     @VH
00529  09DA  F0 1C                 BEQ     @NOMIDDLE
00530  09DC                        ; MIDDLE
00531  09DC  24 FC                 BIT     @HFLAG
00532  09DE  F0 06                 BEQ     @NOMIDHEAD
00533  09E0  A4 FB                 LDY     @VHX                    ; SET SCREEN CHARACTER
00534  09E2  A9 42                 LDA     #O0_FM
00535  09E4  91 18                 STA     (CURSCRNPTR),Y
00536  09E6             @NOMIDHEAD 
00537  09E6  A6 FA                 LDX     @HFOLLOWLEN
00538  09E8             @MIDFOLLOW 
00539  09E8                        ; MIDDLE FOLLOW
00540  09E8  CA                    DEX
00541  09E9  30 08                 BMI     @NOMIDFOLLOW
00542  09EB  C8                    INY
00543  09EC  A9 66                 LDA     #O0_MM
00544  09EE  91 18                 STA     (CURSCRNPTR),Y
00545  09F0  4C E8 09              JMP     @MIDFOLLOW
00546  09F3             @NOMIDFOLLOW 
00547  09F3             
00548  09F3  A4 FE                 LDY     @VH
00549  09F5  4C CA 09              JMP     @MOREMIDDLE
00550  09F8             
00551  09F8             
00552  09F8             @NOMIDDLE
00553  09F8                        ; BOTTOM
00554  09F8  24 FC                 BIT     @HFLAG
00555  09FA  F0 06                 BEQ     @NOBOTHEAD
00556  09FC  A4 FB                 LDY     @VHX
00557  09FE  A9 4A                 LDA     #O0_FB
00558  0A00  91 18                 STA     (CURSCRNPTR),Y
00559  0A02             @NOBOTHEAD 
00560  0A02             
00561  0A02  A6 FA                 LDX     @HFOLLOWLEN
00562  0A04             @BOTTOMFOLLOW 
00563  0A04                        ; BOTTOM FOLLOW
00564  0A04  CA                    DEX
00565  0A05  30 08                 BMI     @NOBOTTOMFOLLOW
00566  0A07  C8                    INY
00567  0A08  A9 43                 LDA     #O0_MB
00568  0A0A  91 18                 STA     (CURSCRNPTR),Y
00569  0A0C  4C 04 0A              JMP     @BOTTOMFOLLOW
00570  0A0F             @NOBOTTOMFOLLOW 
00571  0A0F             
00572  0A0F                        
00573  0A0F             @ENDOBJ
00574  0A0F  A6 FF                 LDX     @CUROBJ                  ; RESTORE CUR OBJ POINTER IN X
00575  0A11                        ; GO THE NEXT OBJECT, PUT THE CURRENT OBJECT IN X AGAIN
00576  0A11                        
00577  0A11                        
00578  0A11             
00579  0A11  A9 00                 LDA     #VIC_BLACK
00580  0A13  8D 20 D0              STA     VIC_BORDERC
00581  0A16             
00582  0A16  4C F7 08              JMP     FOREVER
00583  0A19             
00584  0A19             
00585  0A19             ; ****************************************
00586  0A19             ; PAINTS 3 ROW WITH COLOR IN A
00587  0A19             ; INPUT: CURCOLOR CURRENT COLOR POINTER
00588  0A19             ; ****************************************
00589  0A19             
00590  0A19             TRIBAND
00591  0A19  A0 00                 LDY     #0
00592  0A1B             @NEXTCOLOR 
00593  0A1B  91 14                 STA     (CURCOLOR),Y
00594  0A1D  C8                    INY
00595  0A1E  C0 78                 CPY     #120
00596  0A20  D0 F9                 BNE     @NEXTCOLOR
00597  0A22                        
00598  0A22             
00599  0A22             
00600  0A22  18                    CLC
00601  0A23  A5 14                 LDA CURCOLOR
00602  0A25  69 78                 ADC #<120
00603  0A27  85 14                 STA CURCOLOR
00604  0A29  A5 15                 LDA CURCOLOR+1
00605  0A2B  69 00                 ADC #>120
00606  0A2D  85 15                 STA CURCOLOR+1
00607  0A2F                        
00608  0A2F             
00609  0A2F  60                    RTS
00610  0A30             
00611  0A30             ; **************************
00612  0A30             ; POINTERS TO EACH CHAR ROW
00613  0A30             ; DESTROYS ALL REGISTERS
00614  0A30             ; **************************
00615  0A30             INITMULTABLE 
00616  0A30  A9 00                 LDA     #<SCREEN
00617  0A32  85 16                 STA     CURPTR
00618  0A34  A9 84                 LDA     #>SCREEN
00619  0A36  85 17                 STA     CURPTR+1
00620  0A38             
00621  0A38  A2 00                 LDX     #0
00622  0A3A  A0 19                 LDY     #25
00623  0A3C             
00624  0A3C             @NEXT      
00625  0A3C  A5 16                 LDA     CURPTR          ; MULTABLE[X] = *CURPTR
00626  0A3E  9D A5 0A              STA     MULTABLE,X
00627  0A41  E8                    INX
00628  0A42  A5 17                 LDA     CURPTR+1
00629  0A44  9D A5 0A              STA     MULTABLE,X
00630  0A47  E8                    INX
00631  0A48  88                    DEY
00632  0A49  F0 10                 BEQ     @DONE           ; IF (ALL ROWS DONE) EXIT
00633  0A4B                        
00634  0A4B  18                    CLC                    ; *CURPTR+=40
00635  0A4C  A5 16                 LDA     CURPTR
00636  0A4E  69 28                 ADC     #40
00637  0A50  85 16                 STA     CURPTR
00638  0A52  A5 17                 LDA     CURPTR+1
00639  0A54  69 00                 ADC     #0
00640  0A56  85 17                 STA     CURPTR+1
00641  0A58  4C 3C 0A              JMP     @NEXT
00642  0A5B                        
00643  0A5B             @DONE
00644  0A5B  60                    RTS
00645  0A5C             
00646  0A5C             INITLEVEL
00647  0A5C  A9 01                 LDA     #1
00648  0A5E  85 21                 STA     DELTA   ; SCROLL BY 1 FOR NOW
00649  0A60                        
00650  0A60             
00651  0A60             ;       INIT OBJTABLE WITH "DEMO" OBJECT
00652  0A60  A9 01                 LDA     #1
00653  0A62  8D D7 0A              STA     OBJTABLE+OB_TYPE
00654  0A65  A9 14                 LDA     #20
00655  0A67  8D D8 0A              STA     OBJTABLE+OB_H
00656  0A6A  A9 14                 LDA     #20
00657  0A6C  8D D9 0A              STA     OBJTABLE+OB_L
00658  0A6F  A9 03                 LDA     #3
00659  0A71  8D DA 0A              STA     OBJTABLE+OB_Y
00660  0A74  A9 28                 LDA     #40
00661  0A76  8D DB 0A              STA     OBJTABLE+OB_X1
00662  0A79             
00663  0A79             
00664  0A79  A9 00                 LDA     #0
00665  0A7B  85 20                 STA     DELAY
00666  0A7D             
00667  0A7D  60                    RTS
00668  0A7E             
00669  0A7E             
00670  0A7E             PRINTA
00671  0A7E  85 12                 STA     ATEMP
00672  0A80  4A                    LSR
00673  0A81  4A                    LSR
00674  0A82  4A                    LSR
00675  0A83  4A                    LSR
00676  0A84  29 0F                 AND     #$0F
00677  0A86  09 30                 ORA     #$30
00678  0A88  C9 3A                 CMP     #$3A
00679  0A8A  30 03                 BMI     @OK1
00680  0A8C  38                    SEC
00681  0A8D  E9 39                 SBC     #$39
00682  0A8F             @OK1
00683  0A8F  8D 00 84              STA     SCREEN
00684  0A92  A5 12                 LDA     ATEMP
00685  0A94  29 0F                 AND     #$0F
00686  0A96  09 30                 ORA     #$30
00687  0A98  C9 3A                 CMP     #$3A
00688  0A9A  30 03                 BMI     @OK2
00689  0A9C  38                    SEC
00690  0A9D  E9 39                 SBC     #$39
00691  0A9F             @OK2
00692  0A9F  8D 01 84              STA     SCREEN+1
00693  0AA2  A5 12                 LDA     ATEMP
00694  0AA4  60                    RTS
00695  0AA5             
00696  0AA5             MULTABLE
00697  0AA5  00 00 00              DCW 25,0
00698  0AD7             
00699  0AD7             ; OBJECTS ARE 10 BYTES, THERE ARE 20 OF THEM HERE
00700  0AD7             OBJTABLE
00701  0AD7  00 00 00              DCB 200,0
00702  0B9F             

******* 10 Label(s) *******
forever = $08F7 
initlevel = $0A5C 
initmultable = $0A30 
multable = $0AA5 
objectgen = $093F 
objtable = $0AD7 
printa = $0A7E 
start = $0830 
triband = $0A19 
WAIT = $08F9 

******* 4 Unused label(s) *******
@bottomfollow
@done
@dothisobject
@endobj
@fullhfollow
@hfskip
@loop
@midfollow
@moremiddle
@next
@nextcolor
@nobothead
@nobottomfollow
@nohead
@nol
@nomiddle
@nomidfollow
@nomidhead
@nor
@nos
@notopfollow
@notophead
@nulchar
@ok1
@ok2
@rowloop
@topfollow
@visible
objectgen
objtable
printa
start

******* 88 Variable(s) *******
@curobj  = $00FF
@hflag  = $00FC
@hfollowlen  = $00FA
@hfskiplen  = $00F9
@unused  = $00FD
@vh  = $00FE
@vhx  = $00FB
atemp  = $0012
chars  = $B000
charsetend  = $BFFF
CIAB_PRA  = $DD00
curcolor  = $0014
curptr  = $0016
curscrnptr  = $0018
delay  = $0020
delta  = $0021
framect  = $0013
o0_bb  = $004B
o0_bm  = $0048
o0_bu  = $0049
o0_fb  = $004A
o0_fm  = $0042
o0_fu  = $0055
o0_mb  = $0043
o0_mm  = $0066
o0_mu  = $0043
ob_h  = $0001
ob_l  = $0002
ob_type  = $0000
ob_x1  = $0004
ob_y  = $0003
screen  = $8400
scrptr  = $0010
star_chars0  = $B120
star_chars1  = $B128
starchar  = $0024
tgt_c64  = $0001
VIC_BG0C  = $D021
VIC_BG1C  = $D022
VIC_BG2C  = $D023
VIC_BG3C  = $D024
VIC_BLACK  = $0000
VIC_BLUE  = $0006
VIC_BORDERC  = $D020
VIC_BROWN  = $0009
VIC_COLOR  = $D800
VIC_CYAN  = $0003
VIC_DARKGREY  = $000B
VIC_GREEN  = $0005
VIC_GREY  = $000C
VIC_LIGHTBLUE  = $000E
VIC_LIGHTGRAY  = $000F
VIC_LIGHTGREEN  = $000D
VIC_LIGHTRED  = $000A
VIC_MEM  = $D018
VIC_ORANGE  = $0008
VIC_RASTER  = $D012
VIC_RED  = $0002
VIC_SP0_X  = $D000
VIC_SP0_Y  = $D001
VIC_SP0C  = $D027
VIC_SP0MC  = $D025
VIC_SP1_X  = $D002
VIC_SP1_Y  = $D003
VIC_SP1C  = $D028
VIC_SP1MC  = $D026
VIC_SP2_X  = $D004
VIC_SP2_Y  = $D005
VIC_SP2C  = $D029
VIC_SP3_X  = $D006
VIC_SP3_Y  = $D007
VIC_SP3C  = $D02A
VIC_SP4_X  = $D008
VIC_SP4_Y  = $D009
VIC_SP4C  = $D02B
VIC_SP5_X  = $D00A
VIC_SP5_Y  = $D00B
VIC_SP5C  = $D02C
VIC_SP6_X  = $D00C
VIC_SP6_Y  = $D00D
VIC_SP6C  = $D02D
VIC_SP7_X  = $D00E
VIC_SP7_Y  = $D00F
VIC_SP7C  = $D02E
VIC_SPX  = $D010
VIC_VIOLET  = $0004
VIC_WHITE  = $0001
VIC_YELLOW  = $0007
******* 25 Unused variables(s) *******
@unused
chars
o0_bb
o0_bm
o0_bu
ob_h
ob_l
ob_type
ob_x1
ob_y
star_chars0
star_chars1
tgt_c64
VIC_BG0C
VIC_BG1C
VIC_BG2C
VIC_BG3C
VIC_BROWN
VIC_CYAN
VIC_DARKGREY
VIC_GREEN
VIC_GREY
VIC_LIGHTGRAY
VIC_LIGHTGREEN
VIC_ORANGE
VIC_SP0_X
VIC_SP0_Y
VIC_SP0C
VIC_SP0MC
VIC_SP1_X
VIC_SP1_Y
VIC_SP1C
VIC_SP1MC
VIC_SP2_X
VIC_SP2_Y
VIC_SP2C
VIC_SP3_X
VIC_SP3_Y
VIC_SP3C
VIC_SP4_X
VIC_SP4_Y
VIC_SP4C
VIC_SP5_X
VIC_SP5_Y
VIC_SP5C
VIC_SP6_X
VIC_SP6_Y
VIC_SP6C
VIC_SP7_X
VIC_SP7_Y
VIC_SP7C
VIC_SPX
VIC_VIOLET

